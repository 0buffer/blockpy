<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <script type="text/javascript" src="blockly-master/blockly_uncompressed.js"></script>
    <script type="text/javascript" src="blockly-master/blocks_compressed.js"></script>
    <script type="text/javascript" src="blockly-master/javascript_compressed.js"></script>
    <script type="text/javascript" src="blockly-master/python_compressed.js"></script>
    <script type="text/javascript" src="blockly-master/msg/js/en.js"></script>
    
    <style>
      html, body {
        background-color: #fff;
        margin: 0;
        padding: 0;
        overflow: hidden;
        height: 100%;
      }
      .blocklySvg {
        height: 100%;
        width: 100%;
      }
    </style>
    
    <script src='weather.js'></script>
    
    <script>
    function init() {
        
        function align(){
            var blocks = Blockly.getMainWorkspace().getTopBlocks();
            var y = 0;
            for (var i = 0; i < blocks.length; i++){
                //blocks[i].moveTo(Blockly.Toolbox.width+20, y);
                blocks[i].moveTo(0, y);
                y += blocks[i].getHeightWidth().height;
                y += 20; // buffer
            }
        }
        
        Blockly.Blocks['text_print_multiple'] = {
          // Print statement.
          init: function() {
            this.setHelpUrl(Blockly.Msg.TEXT_PRINT_HELPURL);
            this.setColour(160);
            this.interpolateMsg(Blockly.Msg.TEXT_PRINT_TITLE,
                                ['TEXT', null, Blockly.ALIGN_RIGHT],
                                Blockly.ALIGN_RIGHT);
            this.setPreviousStatement(true);
            this.setNextStatement(true);
            this.setTooltip(Blockly.Msg.TEXT_PRINT_TOOLTIP);
          }
        };
        
        Blockly.Blocks['text_print_multiple'] = {
          // Create a list with any number of elements of any type.
          init: function() {
            this.setColour(260);
            this.appendValueInput('PRINT0')
                .appendTitle('print');
            this.setMutator(new Blockly.Mutator(['text_print_multiple_item']));
            this.setTooltip(Blockly.Msg.TEXT_PRINT_TOOLTIP);
            this.setPreviousStatement(true);
            this.setNextStatement(true);
            this.itemCount_ = 1;
          },
          mutationToDom: function(workspace) {
            var container = document.createElement('mutation');
            container.setAttribute('items', this.itemCount_);
            return container;
          },
          domToMutation: function(container) {
            for (var x = 0; x < this.itemCount_; x++) {
              this.removeInput('PRINT' + x);
            }
            this.itemCount_ = parseInt(container.getAttribute('items'), 10);
            for (var x = 0; x < this.itemCount_; x++) {
              var input = this.appendValueInput('PRINT' + x);
              if (x == 0) {
                input.appendTitle('print');
              }
            }
            if (this.itemCount_ == 0) {
              this.appendDummyInput('EMPTY')
                  .appendTitle('print');
            }
          },
          decompose: function(workspace) {
            var containerBlock = new Blockly.Block(workspace,
                                                   'text_print_multiple_container');
            containerBlock.initSvg();
            var connection = containerBlock.getInput('STACK').connection;
            for (var x = 0; x < this.itemCount_; x++) {
              var itemBlock = new Blockly.Block(workspace, 'text_print_multiple_item');
              itemBlock.initSvg();
              connection.connect(itemBlock.previousConnection);
              connection = itemBlock.nextConnection;
            }
            return containerBlock;
          },
          compose: function(containerBlock) {
            // Disconnect all input blocks and remove all inputs.
            if (this.itemCount_ == 0) {
              this.removeInput('EMPTY');
            } else {
              for (var x = this.itemCount_ - 1; x >= 0; x--) {
                this.removeInput('PRINT' + x);
              }
            }
            this.itemCount_ = 0;
            // Rebuild the block's inputs.
            var itemBlock = containerBlock.getInputTargetBlock('STACK');
            while (itemBlock) {
              var input = this.appendValueInput('PRINT' + this.itemCount_);
              if (this.itemCount_ == 0) {
                input.appendTitle('print');
              }
              // Reconnect any child blocks.
              if (itemBlock.valueConnection_) {
                input.connection.connect(itemBlock.valueConnection_);
              }
              this.itemCount_++;
              itemBlock = itemBlock.nextConnection &&
                  itemBlock.nextConnection.targetBlock();
            }
            if (this.itemCount_ == 0) {
              this.appendDummyInput('EMPTY')
                  .appendTitle('print');
            }
          },
          saveConnections: function(containerBlock) {
            // Store a pointer to any connected child blocks.
            var itemBlock = containerBlock.getInputTargetBlock('STACK');
            var x = 0;
            while (itemBlock) {
              var input = this.getInput('PRINT' + x);
              itemBlock.valueConnection_ = input && input.connection.targetConnection;
              x++;
              itemBlock = itemBlock.nextConnection &&
                  itemBlock.nextConnection.targetBlock();
            }
          }
        };

        Blockly.Blocks['text_print_multiple_container'] = {
          // Container.
          init: function() {
            this.setColour(260);
            this.appendDummyInput()
                .appendTitle('print');
            this.appendStatementInput('STACK');
            this.setTooltip('');
            this.contextMenu = false;
          }
        };

        Blockly.Blocks['text_print_multiple_item'] = {
          // Add items.
          init: function() {
            this.setColour(260);
            this.appendDummyInput()
                .appendTitle('item');
            this.setInputsInline(true);
            this.setPreviousStatement(true);
            this.setNextStatement(true);
            this.setTooltip('');
            this.contextMenu = false;
          }
        };
        
        Blockly.Python['text_print_multiple'] = function(block) {
          // Create a list with any number of elements of any type.
          var inner_prints = new Array(block.itemCount_);
          for (var n = 0; n < block.itemCount_; n++) {
            inner_prints[n] = Blockly.Python.valueToCode(block, 'PRINT' + n,
                Blockly.Python.ORDER_NONE) || 'None';
          }
          code = 'print ' + inner_prints.join(', ') + '\n';
          return code;
        };
        
        Blockly.Blocks['plot_show'] = {
          init: function() {
            this.setHelpUrl('http://www.example.com/');
            this.setColour(330);
            this.appendDummyInput()
                .appendTitle("show plot canvas");
            this.setInputsInline(false);
            this.setPreviousStatement(true);
            this.setNextStatement(true);
            this.setOutput(false);
            this.setTooltip('Makes the canvas appear');
          }
        };
        
        Blockly.Python['plot_show'] = function(block) {
            Blockly.Python.definitions_['import_matplotlib'] = 'import matplotlib.pyplot as plt';
            var code = 'plt.show()\n';
            return code;
        };
        
        Blockly.Blocks['plot_title'] = {
          init: function() {
            this.setHelpUrl('http://www.example.com/');
            this.setColour(330);
            this.appendValueInput('title')
                .setCheck('String')
                .appendTitle("make plot's title");
            this.setInputsInline(true);
            this.setPreviousStatement(true);
            this.setNextStatement(true);
            this.setOutput(false);
            this.setTooltip('Sets the plot\'s title');
          }
        };
        
        Blockly.Python['plot_title'] = function(block) {
            Blockly.Python.definitions_['import_matplotlib'] = 'import matplotlib.pyplot as plt';
            var parameter_plot_title = Blockly.Python.valueToCode(block, 'title',
              Blockly.Python.ORDER_NONE) || '""';
            var code = 'plt.title('+parameter_plot_title+')\n';
            return code;
        };
        
        Blockly.Blocks['plot_line'] = {
          init: function() {
            this.setHelpUrl('http://www.example.com/');
            this.setColour(330);
            this.setPreviousStatement(true);
            this.setNextStatement(true);
            this.appendValueInput("y_values")
                .appendTitle("plot line ")
                .setCheck('Array');
            this.setInputsInline(false);
            this.setOutput(false);
            this.setTooltip('Plots onto the canvas');
          }
        };
        
        Blockly.Python['plot_line'] = function(block) {
            Blockly.Python.definitions_['import_matplotlib'] = 'import matplotlib.pyplot as plt';
            var code = 'plt.plot(';
            var argument1 = Blockly.Python.valueToCode(block, 'y_values',
              Blockly.Python.ORDER_NONE) || '[]';
            code += argument1 +')\n';
            return code;
        };
        
        Blockly.Blocks['plot_scatter'] = {
          init: function() {
            this.setHelpUrl('http://www.example.com/');
            this.setColour(330);
            this.setPreviousStatement(true);
            this.setNextStatement(true);
            this.appendValueInput("x_values")
                .appendTitle("plot scatter ")
                .setCheck('Array');
            this.appendValueInput("y_values")
                .appendTitle("vs. ")
                .setCheck('Array');
            this.setInputsInline(false);
            this.setOutput(false);
            this.setTooltip('Plots onto the canvas');
          }
        };
        
        Blockly.Python['plot_scatter'] = function(block) {
            Blockly.Python.definitions_['import_matplotlib'] = 'import matplotlib.pyplot as plt';
            var code = 'plt.plot(';
            var argument0 = Blockly.Python.valueToCode(block, 'x_values',
              Blockly.Python.ORDER_NONE) || '[]';
            var argument1 = Blockly.Python.valueToCode(block, 'y_values',
              Blockly.Python.ORDER_NONE) || '[]';
            code += argument0 + ','+ argument1 +',\nlinewidth=3, markersize=6,\ndash_capstyle="projecting", markerfacecolor="b")\n';
            return code;
        };
        
        parent.jQuery(document).ready(function() {
            Blockly.inject(document.body,
                {path: 'blockly-master/', 
                 scrollbars: true, 
                 toolbox: document.getElementById('toolbox')});
            // Let the top-level application know that Blockly is ready.
            window.parent.blocklyLoaded(Blockly);
            
            window.parent.resetit();
        });
    }
    </script>
  </head>
  <body onload="init()">
    <xml id="toolbox" style="display: none">
        <category name="Decisions">
            <block type="controls_if"></block>
            <block type="logic_compare"></block>
            <block type="logic_operation"></block>
            <block type="logic_negate"></block>
        </category>
        <category name="Manipulation" custom="VARIABLE">
            <block type="variables_set"></block>
            <block type="variables_get"></block>
        </category>
        <category name="Iteration">
            <block type="controls_forEach"></block>
        </category>
        <category name="Utility">
            <block type="text_print_multiple"></block>
            <block type="type_check"></block>
            <block type="raw_block"></block>
            <block type="raw_expression"></block>
        </category>
        <category name="Functions" custom="PROCEDURE">
        </category>
        <category name="Calculation">
            <block type="math_arithmetic"></block>
            <block type="text_join"></block>
        </category>
        <category name="Plotting">
            <block type="plot_line"></block>
            <block type="plot_scatter"></block>
            <block type="plot_show"></block>
            <block type="plot_title"></block>
        </category>
        <category name="Data - Simple">
            <block type="text"></block>
            <block type="math_number"></block>
            <block type="logic_boolean"></block>
        </category>
        <category name="Data - Lists">
            <block type="lists_create_with"></block>
            <block type="lists_create_empty"></block>
            <block type="lists_getIndex"></block>
            <block type="lists_append"></block>
            <block type="lists_length"></block>
        </category>
        <category name="Data - Dictionaries">
            <block type="dicts_create_with"></block>
            <block type="dict_get"></block>
            <block type="dict_keys"></block>
        </category>
        <category name="Data - Weather">
            <block type="get_temperature">
                <value name="city">
                  <block type="text">
                    <field name="city">Blacksburg, VA</field>
                  </block>
                </value>
            </block>
            <block type="get_report"></block>
            <block type="get_forecasts"></block>
            <block type="get_forecasted_reports"></block>
        </category>
    </xml>
  </body>
</html>
